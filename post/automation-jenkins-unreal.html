<html lang="en"><head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Game Development Portfolio of Patrice Vignola">
    <meta name="author" content="Patrice Vignola">

    <title>Patrice Vignola - Automation With Unreal Engine And Jenkins-CI</title>

    <!-- Bootstrap Core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

	<link href="../css/freelancer.css" rel="stylesheet">
	

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
	
	<link href="../css/clean-blog.min.css" rel="stylesheet">
	<link href="../css/blog-font-1.css" rel="stylesheet" type="text/css">
	<link href="../css/blog-font-2.css" rel="stylesheet" type="text/css">
	
	 <!-- Custom CSS -->
    <link href="../css/style.css" rel="stylesheet">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

<style type="text/css"></style></head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../index">Patrice Vignola</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<a  href="https://www.linkedin.com/in/patricevignola" class="btn-social btn-outline"><i class="fa fa-linkedin"></i></a>
				<a  href="https://twitter.com/patvignola" class="btn-social btn-outline"><i class="fa fa-twitter"></i></a>
				<a  href="mailto:vignola.patrice@gmail.com" class="btn-social btn-outline"><i class="fa fa-envelope"></i></a>
                <ul class="nav navbar-nav navbar-right">
					<li>
                        <a href="../projects">Projects</a>
                    </li>
					<li>
                        <a href="../posts">Posts</a>
                    </li>
                    <li>
                        <a href="../about">About</a>
                    </li>
					<!--
                    <li>
                        <a href="contact">Contact</a>
                    </li>-->
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    

    <!-- Post Content -->
    <article>
        <div class="container main-content">
			<br />
			<br />
			
			<div class="col-md-8 col-md-offset-2 text-center">
            <img class="img-responsive center-block img-rounded" src="../img/jenkins-unreal-logo.png" alt="">
            <h2 class="post-title">
				Automation with Unreal Engine and Jenkins-CI
			</h2>
            <hr class="star-primary">
          </div>
		
            <div class="row">
                <div class="col-md-8 col-md-offset-2">
                    <p>
						As developers, automation is a very powerful tool to have for many reasons. First and foremost, it ensures that the team almost always has access to the latest build without having to lose their precious time building it.
						Also, if a developer finds a bug, having a build independant of individual development configurations can tell us if the bug is in the depot or only on his machine. Finally, you can successively build for multiple configurations (x64, x86, Development, Shipping) and send them to the appropriate people.
					</p>

                    <p>
						This is why I absolutely wanted to have automation before even starting to work on <a href="../project/astral-tides">Astral Tides</a>. Even though I had never tried to make Jenkins work with Unreal Engine before, I knew it would save us a lot of time and problems down the road.
					</p>

                    <p>
						Since I didn't find a whole lot of guides combining Jenkins and Unreal on the web, I thought I would make one myself and let my fellow developers avoid the mistakes I made. The few guides I found were not bad by any means, but I felt like they were skipping over some basic stuff in favor of more advanced automation setups. They were also not explaining how to automatically compile the C++ code from Jenkins, which quickly becomes a problem as soon as you have more than one programmer working on the project.
					</p>
					
					<p>
						This guide will therefore cover the following topics:
						<ul>
							<li><a href="#setup-jenkins">Setup Jenkins</a></li>
							<li><a href="#create-new-jenkins-project">Create a new Jenkins project</a></li>
							<li><a href="#link-jenkins-with-perforce">Link Jenkins with Perforce (optional)</a></li>
							<li><a href="#automatically-build-your-game">Automatically Build Your Game</a></li>
							<li><a href="#parameterize-your-build">Parameterize your build (optional)</a></li>
						</ul>
					</p>

                    <h3 class="section-heading" id="setup-jenkins">Setup Jenkins</h3>

                    <p>
						Setupping Jenkins is really easy: all you need is a server you can install the service on. Even though Jenkins runs really well on Linux, in our case we absolutely need a Windows server since it's not possible to build an Unreal Engine game for Windows using anything else.
						So, once you have downloaded and installed the Windows Installer Package available <a href="https://jenkins.io/content/thank-you-downloading-windows-installer/">over here</a>, you will end up againt a nice welcome page if you type <a href="http://localhost:8080/">localhost:8080</a> in your favorite browser:
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-1.png" alt="Welcome page"></img>
					</p>

					<p>
						If you don't see that screen, it probably means that the service didn't start automatically. You can fix this by opening your task manager, going to the "Services" tab and making sure that the status is "Running":
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-2.png" alt="The service is running"></img>
					</p>
					
					<p>
						Now, if you try to access your server directly from its IP address, you might see a "This site can't be reached" error. This is probably due to the 8080 port not being forwarded correctly. You can google "How to forward a port" and the steps should be pretty straightforward, depending on your configuration.
					</p>
					
					<h3 class="section-heading" id="create-new-jenkins-project">Create a new Jenkins project</h3>

                    <p>
						First of all, locate the "New Item" option available in the left sidebar menu of the home page of Jenkins. After clicking on it, select "Freestyle project" and enter the name of your project in the "Item name" field:
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-3.png" alt="The service is running"></img>
					</p>
					
					<p>
						This is now the occasion to tell Jenkins which Source Code Management we wish to use and configure it accordingly:
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-4.png" alt="Select your Source Code Management"></img>
					</p>
					
					<p>
						You might have noticed that Perforce is not there yet. If you want to link Jenkins to Perforce, follow me to the next section. Otherwise, you can configure your own Source Code Management settings and then skip to the next part of this guide, <a href="#automatically-build-your-game">Automatically Build Your Game</a>. 
					</p>
					
                    <h3 class="section-heading" id="link-jenkins-with-perforce">Link Jenkins with perforce (optional)</h3>

                    <p>
						This part is optional and only relevant if you are using Perforce. If you plan to use Subversion or CVS, you can skip it entirely.
					</p>
					
					<p>
						There are 2 plugins that we can use in order to link Jenkins with Perforce. The first (older) one is called <a href="https://wiki.jenkins-ci.org/display/JENKINS/Perforce+Plugin">Perforce Plugin</a>, and the other (official) one is called <a href="https://wiki.jenkins-ci.org/display/JENKINS/P4+Plugin">P4 Plugin</a>.
						For this guide, I chose to use the older of the two since it's still being updated regularly and I never had any problems with it, but you can use the official P4 Plugin and ignore this part. Like I said, it's entirely optional.
						You can install the Perforce Plugin directly from Jenkins by clicking on "Manage Jenkins" and then selecting the "Manage Plugins" option:
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-10.png" alt="Create a new Jenkins project"></img>
					</p>
					
					<p>
						Now, if you switch to the "Available" tab and start typing "perforce" in the filter box, you should see the 2 plugins I mentioned earlier. Select "Perforce Plugin" and click on the "Download now and install after restart" button:
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-11.png" alt="Install the Perforce plugin"></img>
					</p>
					
					<p>
						Jenkins will proceed to install the plugin and, after you check "Restart Jenkins when installation is complete and no jobs are running" (required), you will be able to finally select Perforce as your Source Code Management settings for the project you created earlier.
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-12.png" alt="Install the Perforce plugin"></img>
					</p>
					
					<p>
						Now, go back to your project, select Perforce and enter the following informations:
						<ul>
							<li>The P4PORT of your depot under the format hostname:port (usually hostname:1666)</li>
							<li>Your perforce username</li>
							<li>Your perforce password</li>
							<li>Your perforce workspace</li>
							<li>The View Map of your depot</li>
						</ul>
					</p>
					
					<p>
						Most of this infos is straightforward (and I can't help you with it), but if you don't know what to enter for the View Map, just type in your depot under the format <strong>//depot name/...</strong> And if you have no idea what your depot is, you can open the Perforce client and look over here (it's the root):
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-13.png" alt="Perforce depot name"></img>
					</p>
					
					<p>
						If you entered all the information correctly and your depot is now empty, you should be able to hit the "Build" button in the project's left sidebar and see something that looks like this in the Console Output:
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-14.png" alt="Perforce depot name"></img>
					</p>
					
					<p>
						Congratulations, your Perforce setup is now over. It wasn't too hard, but people sometimes struggle with one or two things because they are not sure which plugin to download. Now, the rest of the guide won't need to know if you use Perforce or not.
					</p>
					
					<h3 class="section-heading" id="automatically-build-your-game">Automatically build your game</h3>

                    <p>
						This is where we are going to do the bulk of the job and make our automation setup finally come to life. The first thing you need to specify is how often you want Jenkins to build a new version of your game, under the section <strong>Build Triggers</strong>. Usually, the popular option here is "Poll SCM", which means that jenkins will scan your depot every X seconds, minutes or hours and build only if it sees changes. You rarely want to build periodically since it will trigger a lot of useless builds, especially for smaller teams that don't submit a lot of changelists. For the schedule, even though Jenkins explains it well enough if you click on the question mark, it might still be confusing. In my own setup, to poll my SCM every 5 minutes, I used <strong>H/5 * * * *</strong>:
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-15.png" alt="Perforce depot name"></img>
					</p>
					
					<p>
						Now, the section called <strong>Build</strong> is where the real magic happens. This section is located near the bottom of the page, and this is where you will put all your batch commands. <strong>Note: You can also put Shell, Maven or Ant commands, but since we have to use a Windows OS in order to make Windows builds with Unreal, we have to use batch commands.</strong>
					</p>
					
					<p>
						There are a lot of command setups you can use to build automatically with Unreal Engine, but since the purpose of this guide is to offer a straightforward and A to Z guide for beginners, I will offer my solution. I will therefore put every single command I use, <strong>in order</strong>, and explain its purpose right below.
					</p>
					
					<p>
						<blockquote class="code">
							rd /s /q temp
						</blockquote>
						<ul><li>
							The purpose of this command is simply to make sure that we have a clean folder to work with every time. This is important to put it at the very beginning since builds may sometimes fail in the middle or be canceled, so we would find ourselves with an existing temporary folder for subsequent builds (and we don't want that). It will be explained later on what to put in this folder.
						</li></ul>
					</p>

					<p>
						<blockquote class="code">
							"absolute/path/to/unreal/Engine/Binaries/DotNet/UnrealBuildTool.exe" -projectfiles -project="%WORKSPACE%/ProjectName/ProjectName.uproject" -game -rocket -progress
						</blockquote>
						<ul><li>
							The absolute path to unreal should look like <strong>C:/Program Files/Epic Games/4.10</strong> and the <strong>%WORKSPACE%</strong> variable will nicely translate the absolute path of your Jenkins project's workspace for you. This command uses the Unreal Build Tool in order to generate the project files and is the equivalent of right-clicking on the .uproject file and selecting <strong>Generate Visual Studio project files</strong>. I didn't find any official documentation on this, but I found it was a necessary step to make sure that the .sln exists and to make sure that all the prerequisites are up to date.
						</li></ul>
					</p>
					
					<p>
						<blockquote class="code">
							"absolute/path/to/MSBuild/14.0/Bin/MSBuild.exe" "ProjectName\ProjectName.sln" /t:build /p:Configuration="Development Editor";Platform=Win64;verbosity=diagnostic
						</blockquote>
						<ul><li>
							The absolute path to MSBuild should look like <strong>C:/Program Files (x86)/MSBuild</strong> and the <strong>14.0</strong> folder is entirely dependant on the version of Visual Studio you have; pick the folder available for you.
							This command will make sure that the dll (so basically the compiled game) is always up to date. Again, I didn't find any documentation related to this and found the command by trial and error, but I found it to be a crucial step in order to successfully build the game. The reasoning behind it is that, since the game's .dll is not something you should ever version control when working with multiple programmers, something independant needs to build it on its own and this is the best way I found. The build will still work if you omit this command, but it might not be up to date.
						</li></ul>
					</p>
					
					<p>
						<blockquote class="code">
							"absolute/path/to/unreal/Engine/Build/BatchFiles/RunUAT.bat" BuildCookRun -rocket -nocompile -nocompileeditor -installed -nop4 -project="absolute/path/to/jenkins/workspace/ProjectName/ProjectName.uproject" -cook -stage -archive -archivedirectory="absolute/path/to/jenkins/workspace/ProjectName/temp/Development/x64" -package -clientconfig=Development -ue4exe=UE4Editor-Cmd.exe -clean -pak -prereqs -distribution -nodebuginfo -targetplatform=Win64 -build -utf8output
						</blockquote>
						<ul><li>
							This is where most of the job is done. I am not going to explain every parameters in detail, but this command will essentially build the game by using the .dll we compiled earlier and all the assets and blueprints in your project in order to make an executable. If you want faster builds, you can remove the <strong>-clean</strong> parameter, but this is unsafe and you might still need to do a clean build regularly to make sure that you don't have leftovers. You can also change the target platform to target x86 instead (Win32).
						</li></ul>
					</p>
					
					<p>
						<blockquote class="code">
							ren temp\Development\x64\WindowsNoEditor %P4_CHANGELIST%_ProjectName_Development_x64
						</blockquote>
						<ul><li>
							This step is completely optional, but it's nice to have and makes things easier to work with. What Unreal does is putting your game in a <strong>WindowsNoEditor</strong>, so what we do here is simply rename that folder to a name that is directly linked to the revision of the SCM. I used <strong>%P4_CHANGELIST%</strong> because I'm working with Perforce, but it works for other SCM too. For Subversion, you can use <strong>%SVN_REVISION%</strong> instead.
						</li></ul>
					</p>
					
					<p>
						<blockquote class="code">
							"absolute/path/to/7zip/7z.exe" a -t7z builds/Development/%P4_CHANGELIST%_ProjectName/%P4_CHANGELIST%_ProjectName_Development_x64.rar "%WORKSPACE%/temp/development/x64/%P4_CHANGELIST%_ProjectName_Development_x64"
						</blockquote>
						<ul><li>
							For this command, you can choose the file archiver of your choice; it doesn't really matter. It only needs to be able to archive a folder and produce a .rar or a .zip. <strong>Note: If you are using 7zip, you need to provide the full, absolute path to the build folder (e.g. 114700_ProjectName). Otherwise, it will store all the relative folder hierarchy in the .rar archive and bury the executable 5 or 6 folders deep.</strong>
						</li></ul>
					</p>
					
					<p>
						When you are done, this will give you a nice big block of commands:
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-16.png" alt="Build commands"></img>
					</p>
					
					<p>
						Finally, we need to tell Jenkins where to find our <strong>artifact</strong>. An artifact is something that Jenkins considers as the final result of a build and it's what will be made available over the internet for people to download. In our case, it's the .rar archive we did earlier. We tell Jenkins where to find that artifact in the <strong>Post-build Actions</strong> section, right below the <strong>Build</strong> section we just finished with:
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-17.png" alt="Artifact location"></img>
					</p>
					
					<p>
						You will probably have a <strong>doesn't match anything</strong> error like me, and it's perfectly normal. This is because we use variables to set the name of the artifact, and Jenkins is freaking out because it doesn't know that. But don't worry; it will still work. Now, if you start a new build, it will hopefully be successful and Jenkins will give you something like this:
					</p>
					
					<p>
						<img class="img-responsive" src="../guides/jenkins/jenkins-18.png" alt="Artifact location"></img>
					</p>
					
					<p>
						Hooray!! We are now essentially done. We can stop here and have a perfectly fine development build that will frequently poll our SCM and start a new build if necessary, or we can do even better. What if, with only one click, we were able to build a <strong>Shipping</strong> version of the game that will be optimized and ready to be sent to the public? This is exactly what we are going to do in the next section. Let's go!
					</p>
					
					<h3 class="section-heading" id="parameterize-your-build">Parameterize your build (optional)</h3>

                    <p>
						Coming soon...
					</p>
					
					<h3 class="section-heading">Conclusion</h3>

                    <p>
						This guide ended up being longer than I initially thought, but I hope it helped some developers who wanted to try automation with Unreal Engine and Jenkins for the first time.
						Don't hesitate to contact me on twitter <a href="https://twitter.com/patvignola">@patvignola</a> if you have any questions or comments for me.
					</p>
                </div>
            </div>
        </div>
    </article>

    <!-- Footer -->
        <footer class="text-center" style="margin-top: 50px;">
        <div class="footer-above">
            <div class="container">
                <div class="row">
                    <div class="footer-col col-md-4">
                        <h3>Location</h3>
                        <p>Montreal, Canada</p>
                    </div>
                    <div class="footer-col col-md-4">
                        <h3>Contact Me</h3>
                        <ul class="list-inline">
                            <li>
                                <a href="https://twitter.com/patvignola" class="btn-social btn-outline"><i class="fa fa-fw fa-twitter"></i></a>
                            </li>
                            <li>
                                <a href="https://www.linkedin.com/in/patricevignola" class="btn-social btn-outline"><i class="fa fa-fw fa-linkedin"></i></a>
                            </li>
                            <li>
                                <a href="mailto:vignola.patrice@gmail.com" class="btn-social btn-outline"><i class="fa fa-fw fa-envelope"></i></a>
                            </li>
                        </ul>
                    </div>
                    <div class="footer-col col-md-4">
                        <h3>About Me</h3>
                        <p>Patrice is a Software Engineering student at ÉTS (École de Technologie Supérieure), located in Montreal.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-below">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                       Copyright © Patrice Vignola 2016
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="../js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../js/bootstrap.min.js"></script>
	
	<!-- Clean Blog JavaScript -->
    <script src="../js/clean-blog.min.js"></script>

</body>

</html>